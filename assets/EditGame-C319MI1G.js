import{E as P,u as x,r as d,o as _,c as n,a as l,b as p,w as $,d as c,v as f,F as L,e as M,t as g,f as U,g as i,h as A}from"./index-D-RnZ3GF.js";const G={class:"page-content"},T={class:"form-container"},V={key:0,class:"error-text"},C=["disabled"],F=["value","id","disabled"],z=["for"],D={key:0,class:"error-text"},N=["disabled"],O=["disabled"],j={key:1,class:"button-row"},X={__name:"EditGame",setup(q){const w=x(),v=U(),{getAccessTokenSilently:h}=P(),m=w.params.id,o=d(!1),b=["PC","Switch","PS5","XBOX","Mobile"],r=d({titel:"",beschreibung:"",bildurl:"",platforms:[]}),s=d([]),u=d(""),k=async()=>{try{const a=await h(),e=await fetch("http://localhost:8081/api/profile",{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Profil konnte nicht geladen werden");const t=await e.json();o.value=t.role==="ADMIN"}catch(a){console.error("Profil-Fehler:",a),o.value=!1}},y=async()=>{try{const a=await fetch(`http://localhost:8081/api/games/${m}`);if(!a.ok)throw new Error("Laden fehlgeschlagen");const e=await a.json();r.value=e,s.value=e.platforms?e.platforms.map(t=>t.name):[]}catch(a){console.error(a),alert("Spiel konnte nicht geladen werden")}},S=async()=>{if(!o.value)return;if(s.value.some(e=>!b.includes(e))||s.value.length===0){u.value="Bitte wählen Sie mindestens eine gültige Plattform aus.";return}u.value="",r.value.platforms=s.value.map(e=>({name:e}));try{const e=await h();if(!(await fetch(`http://localhost:8081/api/games/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(r.value)})).ok)throw new Error("Update fehlgeschlagen");alert("Spiel erfolgreich aktualisiert!"),v.push({name:"GameOverview"})}catch(e){console.error(e),alert("Fehler beim Speichern!")}},E=async()=>{if(o.value&&confirm("Möchten Sie dieses Spiel wirklich löschen?"))try{const a=await h();if(!(await fetch(`http://localhost:8081/api/games/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Löschen fehlgeschlagen");alert("Spiel erfolgreich gelöscht!"),v.push({name:"GameOverview"})}catch(a){console.error(a),alert("Fehler beim Löschen!")}};return _(()=>{k(),y()}),(a,e)=>(i(),n("div",G,[l("div",T,[e[9]||(e[9]=l("h2",null,"Spiel bearbeiten",-1)),o.value?p("",!0):(i(),n("p",V," Sie haben keine Berechtigung, dieses Spiel zu bearbeiten. ")),l("form",{onSubmit:$(S,["prevent"])},[e[5]||(e[5]=l("label",null,"Titel",-1)),c(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.titel=t),class:"form-control",disabled:!o.value,required:""},null,8,C),[[f,r.value.titel]]),e[6]||(e[6]=l("label",null,"Plattformen",-1)),(i(),n(L,null,M(b,t=>l("div",{key:t,class:"platform-checkbox"},[c(l("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[1]||(e[1]=B=>s.value=B),id:`platform-${t}`,disabled:!o.value},null,8,F),[[A,s.value]]),l("label",{for:`platform-${t}`},g(t),9,z)])),64)),u.value?(i(),n("p",D,g(u.value),1)):p("",!0),e[7]||(e[7]=l("label",null,"Beschreibung",-1)),c(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.beschreibung=t),class:"form-control",disabled:!o.value,required:""},null,8,N),[[f,r.value.beschreibung]]),e[8]||(e[8]=l("label",null,"Bild URL",-1)),c(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.bildurl=t),class:"form-control",disabled:!o.value,required:""},null,8,O),[[f,r.value.bildurl]]),o.value?(i(),n("div",j,[e[4]||(e[4]=l("button",{type:"submit",class:"save-btn"},"Speichern",-1)),l("button",{type:"button",class:"delete-btn",onClick:E}," Löschen ")])):p("",!0)],32)])]))}};export{X as default};
