import{E as P,u as _,r as d,o as x,c as n,a as l,b as p,w as A,d as c,v,F as L,e as U,t as w,A as m,f as M,g as i,h as G}from"./index-BhMh1uag.js";const T={class:"page-content"},V={class:"form-container"},C={key:0,class:"error-text"},F=["disabled"],z=["value","id","disabled"],D=["for"],N={key:0,class:"error-text"},O=["disabled"],R=["disabled"],j={key:1,class:"button-row"},X={__name:"EditGame",setup(q){const k=_(),b=M(),{getAccessTokenSilently:f}=P(),h=k.params.id,r=d(!1),g=["PC","Switch","PS5","XBOX","Mobile"],o=d({titel:"",beschreibung:"",bildurl:"",platforms:[]}),s=d([]),u=d(""),y=async()=>{try{const a=await f(),e=await fetch(`${m}/api/profile`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Profil konnte nicht geladen werden");const t=await e.json();r.value=t.role==="ADMIN"}catch(a){console.error("Profil-Fehler:",a),r.value=!1}},S=async()=>{try{const a=await fetch(`${m}/api/games/${h}`);if(!a.ok)throw new Error("Laden fehlgeschlagen");const e=await a.json();o.value=e,s.value=e.platforms?e.platforms.map(t=>t.name):[]}catch(a){console.error(a),alert("Spiel konnte nicht geladen werden")}},E=async()=>{if(!r.value)return;if(s.value.some(e=>!g.includes(e))||s.value.length===0){u.value="Bitte wählen Sie mindestens eine gültige Plattform aus.";return}u.value="",o.value.platforms=s.value.map(e=>({name:e}));try{const e=await f();if(!(await fetch(`${m}/api/games/${h}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(o.value)})).ok)throw new Error("Update fehlgeschlagen");alert("Spiel erfolgreich aktualisiert!"),b.push({name:"GameOverview"})}catch(e){console.error(e),alert("Fehler beim Speichern!")}},B=async()=>{if(r.value&&confirm("Möchten Sie dieses Spiel wirklich löschen?"))try{const a=await f();if(!(await fetch(`${m}/api/games/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Löschen fehlgeschlagen");alert("Spiel erfolgreich gelöscht!"),b.push({name:"GameOverview"})}catch(a){console.error(a),alert("Fehler beim Löschen!")}};return x(()=>{y(),S()}),(a,e)=>(i(),n("div",T,[l("div",V,[e[9]||(e[9]=l("h2",null,"Spiel bearbeiten",-1)),r.value?p("",!0):(i(),n("p",C," Sie haben keine Berechtigung, dieses Spiel zu bearbeiten. ")),l("form",{onSubmit:A(E,["prevent"])},[e[5]||(e[5]=l("label",null,"Titel",-1)),c(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.titel=t),class:"form-control",disabled:!r.value,required:""},null,8,F),[[v,o.value.titel]]),e[6]||(e[6]=l("label",null,"Plattformen",-1)),(i(),n(L,null,U(g,t=>l("div",{key:t,class:"platform-checkbox"},[c(l("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[1]||(e[1]=$=>s.value=$),id:`platform-${t}`,disabled:!r.value},null,8,z),[[G,s.value]]),l("label",{for:`platform-${t}`},w(t),9,D)])),64)),u.value?(i(),n("p",N,w(u.value),1)):p("",!0),e[7]||(e[7]=l("label",null,"Beschreibung",-1)),c(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.beschreibung=t),class:"form-control",disabled:!r.value,required:""},null,8,O),[[v,o.value.beschreibung]]),e[8]||(e[8]=l("label",null,"Bild URL",-1)),c(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.bildurl=t),class:"form-control",disabled:!r.value,required:""},null,8,R),[[v,o.value.bildurl]]),r.value?(i(),n("div",j,[e[4]||(e[4]=l("button",{type:"submit",class:"save-btn"},"Speichern",-1)),l("button",{type:"button",class:"delete-btn",onClick:B}," Löschen ")])):p("",!0)],32)])]))}};export{X as default};
