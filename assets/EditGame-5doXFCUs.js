import{_,E as x,u as P,r as d,o as $,c as n,a,b as p,w as c,v as f,F as G,d as L,t as g,e as M,f as U,g as i,h as A}from"./index-BS0avWtP.js";const T={class:"form-container"},V={key:0,class:"error-text"},C=["disabled"],F=["value","id","disabled"],z=["for"],D={key:0,class:"error-text"},N=["disabled"],O=["disabled"],j={key:1,class:"button-row"},q={__name:"EditGame",setup(R){const w=P(),v=U(),{getAccessTokenSilently:h}=x(),m=w.params.id,o=d(!1),b=["PC","Switch","PS5","XBOX","Mobile"],r=d({titel:"",beschreibung:"",bildurl:"",platforms:[]}),s=d([]),u=d(""),k=async()=>{try{const l=await h(),e=await fetch("http://localhost:8081/api/profile",{headers:{Authorization:`Bearer ${l}`}});if(!e.ok)throw new Error("Profil konnte nicht geladen werden");const t=await e.json();o.value=t.role==="ADMIN"}catch(l){console.error("Profil-Fehler:",l),o.value=!1}},y=async()=>{try{const l=await fetch(`http://localhost:8081/api/games/${m}`);if(!l.ok)throw new Error("Laden fehlgeschlagen");const e=await l.json();r.value=e,s.value=e.platforms?e.platforms.map(t=>t.name):[]}catch(l){console.error(l),alert("Spiel konnte nicht geladen werden")}},S=async()=>{if(!o.value)return;if(s.value.some(e=>!b.includes(e))||s.value.length===0){u.value="Bitte wählen Sie mindestens eine gültige Plattform aus.";return}u.value="",r.value.platforms=s.value.map(e=>({name:e}));try{const e=await h();if(!(await fetch(`http://localhost:8081/api/games/${m}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(r.value)})).ok)throw new Error("Update fehlgeschlagen");alert("Spiel erfolgreich aktualisiert!"),v.push({name:"GameOverview"})}catch(e){console.error(e),alert("Fehler beim Speichern!")}},E=async()=>{if(o.value&&confirm("Möchten Sie dieses Spiel wirklich löschen?"))try{const l=await h();if(!(await fetch(`http://localhost:8081/api/games/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok)throw new Error("Löschen fehlgeschlagen");alert("Spiel erfolgreich gelöscht!"),v.push({name:"GameOverview"})}catch(l){console.error(l),alert("Fehler beim Löschen!")}};return $(()=>{k(),y()}),(l,e)=>(i(),n("div",T,[e[9]||(e[9]=a("h2",null,"Spiel bearbeiten",-1)),o.value?p("",!0):(i(),n("p",V," Sie haben keine Berechtigung, dieses Spiel zu bearbeiten. ")),a("form",{onSubmit:M(S,["prevent"])},[e[5]||(e[5]=a("label",null,"Titel",-1)),c(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.titel=t),class:"form-control",disabled:!o.value,required:""},null,8,C),[[f,r.value.titel]]),e[6]||(e[6]=a("label",null,"Plattformen",-1)),(i(),n(G,null,L(b,t=>a("div",{key:t,class:"platform-checkbox"},[c(a("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[1]||(e[1]=B=>s.value=B),id:`platform-${t}`,disabled:!o.value},null,8,F),[[A,s.value]]),a("label",{for:`platform-${t}`},g(t),9,z)])),64)),u.value?(i(),n("p",D,g(u.value),1)):p("",!0),e[7]||(e[7]=a("label",null,"Beschreibung",-1)),c(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.beschreibung=t),class:"form-control",disabled:!o.value,required:""},null,8,N),[[f,r.value.beschreibung]]),e[8]||(e[8]=a("label",null,"Bild URL",-1)),c(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.bildurl=t),class:"form-control",disabled:!o.value,required:""},null,8,O),[[f,r.value.bildurl]]),o.value?(i(),n("div",j,[e[4]||(e[4]=a("button",{type:"submit",class:"save-btn"},"Speichern",-1)),a("button",{type:"button",class:"delete-btn",onClick:E}," Löschen ")])):p("",!0)],32)]))}},X=_(q,[["__scopeId","data-v-31eaebf2"]]);export{X as default};
